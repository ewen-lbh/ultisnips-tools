// Generated by LiveScript 1.6.0
(function(){
  var c, one, all, id, ids, snippet, updateResult, listenToAll, updateSnippetObject, insertAtCursor, disableOtherInputs, disableButton, enableButton, disableInsertTabstopButton, disableInsertTriggerRegexGroupButton, ordinalSuffix, uaparser, ua;
  c = console.log;
  one = document.querySelector.bind(document);
  all = document.querySelectorAll.bind(document);
  id = document.getElementById.bind(document);
  ids = function(it){
    return it.map(function(it){
      return id(it);
    });
  };
  /*
  Tab handling
  */
  all('._tabbed').forEach(function(tabbedContent){
    var currentTabController, activeTab;
    currentTabController = tabbedContent.dataset.currentTabController;
    activeTab = '';
    return tabbedContent.querySelectorAll("input[type=radio][name='" + currentTabController + "']").forEach(function(tabSelector){
      var setActiveTab;
      setActiveTab = function(){
        var activeTab;
        if (tabSelector.checked) {
          activeTab = tabSelector.value;
          return tabbedContent.querySelectorAll('[data-tab]').forEach(function(tabContent){
            if (tabContent.dataset.tab === activeTab) {
              return tabContent.setAttribute('data-tab-active', '');
            } else {
              return tabContent.removeAttribute('data-tab-active');
            }
          });
        }
      };
      tabSelector.addEventListener('change', setActiveTab);
      return setActiveTab();
    });
  });
  /*
  Snippet generation
  */
  snippet = {
    priority: null,
    postJump: null,
    context: null,
    trigger: '',
    name: '',
    flags: {
      b: false,
      i: false,
      w: false,
      r: false,
      t: false,
      s: false,
      m: false,
      e: false,
      A: false
    },
    content: ''
  };
  updateResult = function(){
    snippet = {
      priority: id('priority').value || null,
      postJump: id('post-jump').value || null,
      context: id('context').value || null,
      trigger: id('trigger').value,
      name: id('name').value,
      flags: {
        b: id('flag-b').checked,
        i: id('flag-i').checked,
        w: snippet.flags.w,
        r: id('trigger-type--regex').checked,
        t: snippet.flags.t,
        s: snippet.flags.s,
        m: snippet.flags.m,
        e: snippet.flags.e,
        A: id('flag-A').checked
      },
      content: id('content').value
    };
    if (document.focusedElement !== id('result')) {
      console.group('Generating snippet');
      c(snippet);
      console.groupEnd();
      return id('result').value = generateSnippet(
      snippet);
    }
  };
  listenToAll = function(){
    var listenTo;
    listenTo = ids(['priority', 'name', 'trigger', 'content', 'context', 'post-jump', 'trigger-type--regex', 'trigger-type--text', 'flag-i', 'flag-b', 'flag-A', 'insert-tabstop', 'insert-code-python', 'insert-code-vimscript', 'insert-code-shell', 'insert-tabstop-reference', 'insert-trigger-regex-group-reference']);
    console.group('Hooking into inputs\' events');
    listenTo.forEach(function(it){
      var eventName, ref$;
      if (it.tagName === 'BUTTON') {
        eventName = 'click';
      } else if (it.tagName === 'INPUT') {
        if ((ref$ = it.getAttribute('type')) === 'checkbox' || ref$ === 'radio') {
          eventName = 'change';
        } else {
          eventName = 'input';
        }
      } else if (it.tagName === 'TEXTAREA') {
        eventName = 'input';
      }
      c(eventName + " @ #" + it.id);
      return it.addEventListener(eventName, updateResult);
    });
    return console.groupEnd();
  };
  updateResult();
  listenToAll();
  /*
  Snippet parsing
  */
  updateSnippetObject = function(){
    var bindToSnippetProperty;
    bindToSnippetProperty = function(elementId, snippetProperty){
      snippetProperty == null && (snippetProperty = null);
      return id(elementId).value = snippet[snippetProperty || elementId];
    };
    ['priority', 'name', 'trigger', 'content', 'context'].forEach(function(it){
      return bindToSnippetProperty(it);
    });
    bindToSnippetProperty('post-jump', 'postJump');
    id('trigger-type--regex').checked = snippet.flags.r;
    id('trigger-type--text').checked = !snippet.flags.r;
    return ['b', 'i', 'A'].forEach(function(it){
      return id("flag-" + it).checked = snippet.flags[it];
    });
  };
  id('analyze-btn').addEventListener('click', function(){
    import$(snippet, extractSnippet(
    id('result').value));
    return updateSnippetObject();
  });
  /*
  Tab stop/code insertion
  */
  insertAtCursor = function(text){
    var textarea, sel, startPos, endPos;
    textarea = id('content');
    if (document.selection) {
      textarea.focus();
      sel = document.selection.createRange();
      sel.text = text;
    } else {
      if (textarea.selectionStart || textarea.selectionStart === '0') {
        startPos = textarea.selectionStart;
        endPos = textarea.selectionEnd;
        textarea.value = textarea.value.substring(0, startPos) + text + textarea.value.substring(endPos, textarea.value.length);
      } else {
        textarea.value += text;
      }
    }
    updateResult();
    return textarea.focus();
  };
  id('insert-tabstop').addEventListener('click', function(it){
    it.preventDefault();
    insertAtCursor(
    generateTabstop({
      position: parseInt(
      id('tabstop-position').value),
      defaultValue: id('tabstop-type--default').checked ? id('tabstop-default-text').value : null,
      substitution: id('tabstop-type--substitution').checked ? ['find', 'replace'].map(function(it){
        return id("tabstop-substitution-" + it).value;
      }) : null
    }));
    return false;
  });
  /*
  Check radio button when clicked on relevant fields
  */
  all('[id^=tabstop-substitution]').forEach(function(it){
    return it.addEventListener('focus', function(){
      return id('tabstop-type--substitution').click();
    });
  });
  id('tabstop-default-text').addEventListener('focus', function(){
    return id('tabstop-type--default').click();
  });
  /*
  Disable inputs not relevant to currently-selected tabstop type
  */
  disableOtherInputs = function(){
    var contentToToggle;
    contentToToggle = id('tabstop-type--default').parentElement.parentElement.querySelector('._toggled');
    if (id('tabstop-type--default').checked) {
      contentToToggle.classList.remove('_disabled');
    } else {
      contentToToggle.classList.add('_disabled');
    }
    contentToToggle = id('tabstop-type--substitution').parentElement.parentElement.querySelector('._toggled');
    if (id('tabstop-type--substitution').checked) {
      return contentToToggle.classList.remove('_disabled');
    } else {
      return contentToToggle.classList.add('_disabled');
    }
  };
  all('[id^=tabstop-type--]').forEach(function(it){
    return it.addEventListener('change', disableOtherInputs);
  });
  disableOtherInputs();
  /*
  Disable insert tabstop button if the tabstop position is empty
  */
  disableButton = function(elementId){
    var button, whyIsItDisabled;
    button = id(elementId);
    whyIsItDisabled = button.dataset.whyDisabled;
    button.setAttribute('disabled', '');
    if (whyIsItDisabled) {
      return button.setAttribute('title', whyIsItDisabled);
    }
  };
  enableButton = function(elementId){
    var button;
    button = id(elementId);
    button.removeAttribute('disabled');
    return button.removeAttribute('title');
  };
  disableInsertTabstopButton = function(){
    if (!id('tabstop-position').value) {
      return disableButton('insert-tabstop');
    } else {
      return enableButton('insert-tabstop');
    }
  };
  id('tabstop-position').addEventListener('input', disableInsertTabstopButton);
  disableInsertTabstopButton();
  /*
  Insert code
  */
  all('[id^=insert-code-]').forEach(function(it){
    return it.addEventListener('click', function(it){
      insertAtCursor(
      generateCodeEmbed({
        language: it.target.id.replace('insert-code-', ''),
        content: ''
      }));
      return snippet.content = id('content').value;
    });
  });
  /*
  Insert tabstop reference
  */
  id('insert-tabstop-reference').addEventListener('click', function(){
    if (id('tabstop-reference-position').value) {
      insertAtCursor(
      generateTabstopReference({
        language: 'python',
        position: Number(
        id('tabstop-reference-position').value)
      }));
      return snippet.content = id('content').value;
    }
  });
  /*
  Insert trigger regex group reference
  */
  id('insert-trigger-regex-group-reference').addEventListener('click', function(){
    if (id('trigger-regex-group-reference-index').value) {
      insertAtCursor(
      generateTriggerRegexGroupReference({
        language: 'python',
        position: Number(
        id('trigger-regex-group-reference-index').value)
      }));
      return snippet.content = id('content').value;
    }
  });
  /*
  Disable Insert trigger regex group reference button when trigger is not regex
  */
  disableInsertTriggerRegexGroupButton = function(){
    if (id('trigger-type--regex').checked) {
      return enableButton('insert-trigger-regex-group-reference');
    } else {
      return disableButton('insert-trigger-regex-group-reference');
    }
  };
  all('[id^=trigger-type--]').forEach(function(it){
    return it.addEventListener('change', disableInsertTriggerRegexGroupButton);
  });
  disableInsertTriggerRegexGroupButton();
  /*
  Copy to clipboard button
  */
  new ClipboardJS('#copy-result');
  /*
  Make "Acess on the <input type=number>th <Tab> press"'s "th" reactive
  */
  all('.ordinal[data-source]').forEach(function(it){
    var targetElement, sourceElement;
    targetElement = it;
    sourceElement = one(it.dataset.source);
    return sourceElement.addEventListener('input', function(){
      return targetElement.textContent = ordinalSuffix(Number(sourceElement.value));
    });
  });
  ordinalSuffix = function(int){
    if (10 < int && int < 20) {
      return 'th';
    } else {
      switch (Number(
      String(
      int).slice(-1))) {
      case 1:
        return 'st';
      case 2:
        return 'nd';
      case 3:
        return 'rd';
      default:
        return 'th';
      }
    }
  };
  /*
  Result <textarea> position
  */
  all('[name=result-position]').forEach(function(it){
    return it.addEventListener('change', function(it){
      var val;
      val = it.target.value;
      if (it.target.checked) {
        return id('analyze').dataset.position = val;
      }
    });
  });
  /*
  Turn the 'r' flag key-hint on/off depending on the trigger type
  (#10)
  */
  id('trigger-type--regex').addEventListener('input', function(){
    if (id('trigger-type--regex').checked) {
      return one('label[for=trigger] ~ .key-hint').dataset.state = 'on';
    }
  });
  id('trigger-type--text').addEventListener('input', function(){
    if (id('trigger-type--text').checked) {
      return one('label[for=trigger] ~ .key-hint').dataset.state = 'off';
    }
  });
  /*
  Warn about FF<79 (#9)
  */
  uaparser = new UAParser();
  ua = uaparser.getResult();
  if (ua.browser.name === 'Firefox' && Number(ua.browser.major < 79)) {
    id('browser-not-supported').style.display = 'block';
  } else {
    id('browser-not-supported').style.display = 'none';
  }
  all('span[data-key=detectedBrowser]').forEach(function(it){
    return it.textContent = ua.browser.name + " " + ua.browser.version;
  });
  function import$(obj, src){
    var own = {}.hasOwnProperty;
    for (var key in src) if (own.call(src, key)) obj[key] = src[key];
    return obj;
  }
}).call(this);
